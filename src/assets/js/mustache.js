/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */
(function(f,e){if(typeof exports==="object"&&exports){e(exports)}else{var d={};e(d);if(typeof define==="function"&&define.amd){define(d)}else{f.Mustache=d}}}(this,function(V){var R=/\s*/;var I=/\s+/;var M=/\S/;var O=/\s*=/;var E=/\s*\}/;var y=/#|\^|\/|>|\{|&|=|!/;var Q=RegExp.prototype.test;function z(a,b){return Q.call(a,b)}function P(a){return !z(M,a)}var H=Object.prototype.toString;var L=Array.isArray||function(a){return H.call(a)==="[object Array]"};function S(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var T={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function F(a){return String(a).replace(/[&<>"'\/]/g,function(b){return T[b]})}function J(a){this.string=a;this.tail=a;this.pos=0}J.prototype.eos=function(){return this.tail===""};J.prototype.scan=function(a){var b=this.tail.match(a);if(b&&b.index===0){this.tail=this.tail.substring(b[0].length);this.pos+=b[0].length;return b[0]}return""};J.prototype.scanUntil=function(a){var b,c=this.tail.search(a);switch(c){case -1:b=this.tail;this.pos+=this.tail.length;this.tail="";break;case 0:b="";break;default:b=this.tail.substring(0,c);this.tail=this.tail.substring(c);this.pos+=c}return b};function A(b,a){this.view=b||{};this.parent=a;this._cache={}}A.make=function(a){return(a instanceof A)?a:new A(a)};A.prototype.push=function(a){return new A(a,this)};A.prototype.lookup=function(c){var a=this._cache[c];if(!a){if(c=="."){a=this.view}else{var b=this;while(b){if(c.indexOf(".")>0){a=b.view;var e=c.split("."),d=0;while(a&&d<e.length){a=a[e[d++]]}}else{a=b.view[c]}if(a!=null){break}b=b.parent}}this._cache[c]=a}if(typeof a==="function"){a=a.call(this.view)}return a};function C(){this.clearCache()}C.prototype.clearCache=function(){this._cache={};this._partialCache={}};C.prototype.compile=function(d,b){var a=this._cache[d];if(!a){var c=V.parse(d,b);a=this._cache[d]=this.compileTokens(c,d)}return a};C.prototype.compilePartial=function(a,b,d){var c=this.compile(b,d);this._partialCache[a]=c;return c};C.prototype.getPartial=function(a){if(!(a in this._partialCache)&&this._loadPartial){this.compilePartial(a,this._loadPartial(a))}return this._partialCache[a]};C.prototype.compileTokens=function(c,a){var b=this;return function(f,d){if(d){if(typeof d==="function"){b._loadPartial=d}else{for(var e in d){b.compilePartial(e,d[e])}}}return D(c,b,A.make(f),a)}};C.prototype.render=function(c,b,a){return this.compile(c)(b,a)};function D(k,d,g,h){var a="";var c,j,i;for(var m=0,l=k.length;m<l;++m){c=k[m];j=c[1];switch(c[0]){case"#":i=g.lookup(j);if(typeof i==="object"){if(L(i)){for(var b=0,e=i.length;b<e;++b){a+=D(c[4],d,g.push(i[b]),h)}}else{if(i){a+=D(c[4],d,g.push(i),h)}}}else{if(typeof i==="function"){var f=h==null?null:h.slice(c[3],c[5]);i=i.call(g.view,f,function(n){return d.render(n,g)});if(i!=null){a+=i}}else{if(i){a+=D(c[4],d,g,h)}}}break;case"^":i=g.lookup(j);if(!i||(L(i)&&i.length===0)){a+=D(c[4],d,g,h)}break;case">":i=d.getPartial(j);if(typeof i==="function"){a+=i(g)}break;case"&":i=g.lookup(j);if(i!=null){a+=i}break;case"name":i=g.lookup(j);if(i!=null){a+=V.escape(i)}break;case"text":a+=j;break}}return a}function G(h){var f=[];var b=f;var a=[];var e;for(var d=0,g=h.length;d<g;++d){e=h[d];switch(e[0]){case"#":case"^":a.push(e);b.push(e);b=e[4]=[];break;case"/":var c=a.pop();c[5]=e[2];b=a.length>0?a[a.length-1][4]:f;break;default:b.push(e)}}return f}function U(a){var d=[];var b,f;for(var c=0,e=a.length;c<e;++c){b=a[c];if(b){if(b[0]==="text"&&f&&f[0]==="text"){f[1]+=b[1];f[3]=b[3]}else{f=b;d.push(b)}}}return d}function B(a){return[new RegExp(S(a[0])+"\\s*"),new RegExp("\\s*"+S(a[1]))]}function K(b,r){b=b||"";r=r||V.tags;if(typeof r==="string"){r=r.split(I)}if(r.length!==2){throw new Error("Invalid tags: "+r.join(", "))}var n=B(r);var k=new J(b);var p=[];var q=[];var g=[];var a=false;var c=false;function d(){if(a&&!c){while(g.length){delete q[g.pop()]}}else{g=[]}a=false;c=false}var h,j,o,m,i;while(!k.eos()){h=k.pos;o=k.scanUntil(n[0]);if(o){for(var f=0,e=o.length;f<e;++f){m=o.charAt(f);if(P(m)){g.push(q.length)}else{c=true}q.push(["text",m,h,h+1]);h+=1;if(m=="\n"){d()}}}if(!k.scan(n[0])){break}a=true;j=k.scan(y)||"name";k.scan(R);if(j==="="){o=k.scanUntil(O);k.scan(O);k.scanUntil(n[1])}else{if(j==="{"){o=k.scanUntil(new RegExp("\\s*"+S("}"+r[1])));k.scan(E);k.scanUntil(n[1]);j="&"}else{o=k.scanUntil(n[1])}}if(!k.scan(n[1])){throw new Error("Unclosed tag at "+k.pos)}i=[j,o,h,k.pos];q.push(i);if(j==="#"||j==="^"){p.push(i)}else{if(j==="/"){if(p.length===0){throw new Error('Unopened section "'+o+'" at '+h)}var l=p.pop();if(l[1]!==o){throw new Error('Unclosed section "'+l[1]+'" at '+h)}}else{if(j==="name"||j==="{"||j==="&"){c=true}else{if(j==="="){r=o.split(I);if(r.length!==2){throw new Error("Invalid tags at "+h+": "+r.join(", "))}n=B(r)}}}}}var l=p.pop();if(l){throw new Error('Unclosed section "'+l[1]+'" at '+k.pos)}q=U(q);return G(q)}V.name="mustache.js";V.version="0.7.2";V.tags=["{{","}}"];V.Scanner=J;V.Context=A;V.Writer=C;V.parse=K;V.escape=F;var N=new C();V.clearCache=function(){return N.clearCache()};V.compile=function(a,b){return N.compile(a,b)};V.compilePartial=function(a,c,b){return N.compilePartial(a,c,b)};V.compileTokens=function(a,b){return N.compileTokens(a,b)};V.render=function(c,b,a){return N.render(c,b,a)};V.to_html=function(c,b,e,a){var d=V.render(c,b,e);if(typeof a==="function"){a(d)}else{return d}}}));